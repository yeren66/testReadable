<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŠ¶æ€è°ƒè¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 6px; }
        .debug-section h3 { margin-top: 0; color: #007bff; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; background: #007bff; color: white; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” çŠ¶æ€è°ƒè¯•é¡µé¢</h1>
        
        <div class="debug-section">
            <h3>ğŸ“Š å½“å‰æ•°æ®çŠ¶æ€</h3>
            <button onclick="loadCurrentData()">åŠ è½½å½“å‰æ•°æ®</button>
            <button onclick="debugEvaluationStatus()">è°ƒè¯•è¯„åˆ†çŠ¶æ€</button>
            <div id="currentDataOutput"></div>
        </div>

        <div class="debug-section">
            <h3>ğŸ§ª æµ‹è¯•è¯„åˆ†çŠ¶æ€å‡½æ•°</h3>
            <button onclick="testStatusFunction()">æµ‹è¯•çŠ¶æ€å‡½æ•°</button>
            <div id="statusTestOutput"></div>
        </div>

        <div class="debug-section">
            <h3>ğŸ“ è¯¦ç»†æ—¥å¿—</h3>
            <div id="debugLog"></div>
            <button onclick="clearDebugLog()">æ¸…é™¤æ—¥å¿—</button>
        </div>
    </div>

    <script>
        // å¤åˆ¶ä¸»åº”ç”¨çš„æ ¸å¿ƒé€»è¾‘
        class DebugApp {
            constructor() {
                this.evaluationData = JSON.parse(localStorage.getItem('evaluationData') || '{}');
                this.methodToolMappings = JSON.parse(localStorage.getItem('methodToolMappings') || '{}');
                // ç®€åŒ–çš„æµ‹è¯•æ–¹æ³•åˆ—è¡¨
                this.testMethods = [
                    { name: 'chart_compareTo' },
                    { name: 'chart_createWindPlot' },
                    { name: 'chart_getHeight' },
                    { name: 'chart_getLeft' },
                    { name: 'chart_getPaint' },
                    { name: 'chart_getRadius' },
                    { name: 'chart_isLeft' }
                ];
            }

            // æ£€æŸ¥è¯„åˆ†çŠ¶æ€
            getEvaluationStatus() {
                const notStarted = [];      // æœªå¼€å§‹è¯„åˆ†çš„æ–¹æ³•
                const incomplete = [];      // éƒ¨åˆ†å®Œæˆçš„æ–¹æ³•
                const completed = [];       // å®Œå…¨å®Œæˆçš„æ–¹æ³•
                
                debugLog(`å¼€å§‹æ£€æŸ¥ ${this.testMethods.length} ä¸ªæ–¹æ³•çš„è¯„åˆ†çŠ¶æ€...`);
                
                for (const method of this.testMethods) {
                    debugLog(`\næ£€æŸ¥æ–¹æ³•: ${method.name}`);
                    
                    const methodData = this.evaluationData[method.name];
                    if (!methodData) {
                        debugLog(`  - æ²¡æœ‰è¯„åˆ†æ•°æ®ï¼Œæ ‡è®°ä¸ºæœªå¼€å§‹`);
                        notStarted.push(method.name);
                        continue;
                    }

                    // æ£€æŸ¥è¯¥æ–¹æ³•çš„æ‰€æœ‰å·¥å…·æ˜¯å¦éƒ½å·²è¯„åˆ†
                    const toolMapping = this.methodToolMappings[method.name];
                    if (!toolMapping) {
                        debugLog(`  - æ²¡æœ‰å·¥å…·æ˜ å°„ï¼Œæ ‡è®°ä¸ºæœªå¼€å§‹`);
                        notStarted.push(method.name);
                        continue;
                    }

                    debugLog(`  - å·¥å…·æ˜ å°„: ${JSON.stringify(toolMapping)}`);
                    debugLog(`  - è¯„åˆ†æ•°æ®: ${JSON.stringify(methodData)}`);

                    let hasIncompleteEvaluation = false;
                    let hasAnyEvaluation = false;

                    for (const toolId in toolMapping) {
                        debugLog(`    æ£€æŸ¥å·¥å…·: ${toolId}`);
                        const toolData = methodData[toolId];
                        if (!toolData || Object.keys(toolData).length === 0) {
                            debugLog(`      - å·¥å…· ${toolId} æ²¡æœ‰è¯„åˆ†æ•°æ®`);
                            hasIncompleteEvaluation = true;
                            continue;
                        }

                        hasAnyEvaluation = true;
                        debugLog(`      - å·¥å…· ${toolId} æœ‰è¯„åˆ†æ•°æ®: ${JSON.stringify(toolData)}`);

                        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰è¯„åˆ†ç»´åº¦éƒ½å·²å®Œæˆ
                        const requiredCriteria = ['naming', 'layout', 'assertion', 'migration'];
                        for (const criterion of requiredCriteria) {
                            if (!toolData[criterion] || toolData[criterion] === 0) {
                                debugLog(`      - å·¥å…· ${toolId} ç¼ºå°‘ç»´åº¦ ${criterion}`);
                                hasIncompleteEvaluation = true;
                                break;
                            }
                        }
                    }

                    if (!hasAnyEvaluation) {
                        debugLog(`  - æ–¹æ³• ${method.name} æ²¡æœ‰ä»»ä½•è¯„åˆ†ï¼Œæ ‡è®°ä¸ºæœªå¼€å§‹`);
                        notStarted.push(method.name);
                    } else if (hasIncompleteEvaluation) {
                        debugLog(`  - æ–¹æ³• ${method.name} æœ‰ä¸å®Œæ•´çš„è¯„åˆ†ï¼Œæ ‡è®°ä¸ºéƒ¨åˆ†å®Œæˆ`);
                        incomplete.push(method.name);
                    } else {
                        debugLog(`  - æ–¹æ³• ${method.name} è¯„åˆ†å®Œæ•´ï¼Œæ ‡è®°ä¸ºå·²å®Œæˆ`);
                        completed.push(method.name);
                    }
                }

                const result = {
                    notStarted,
                    incomplete,
                    completed,
                    totalUnevaluated: notStarted.length + incomplete.length
                };

                debugLog(`\næœ€ç»ˆç»Ÿè®¡ç»“æœ:`);
                debugLog(`- æœªå¼€å§‹: ${notStarted.length} ä¸ª`);
                debugLog(`- éƒ¨åˆ†å®Œæˆ: ${incomplete.length} ä¸ª`);
                debugLog(`- å·²å®Œæˆ: ${completed.length} ä¸ª`);
                debugLog(`- æ€»æœªå®Œæˆ: ${result.totalUnevaluated} ä¸ª`);

                return result;
            }
        }

        const debugApp = new DebugApp();

        function debugLog(message) {
            const logDiv = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearDebugLog() {
            document.getElementById('debugLog').innerHTML = '';
        }

        function loadCurrentData() {
            const output = document.getElementById('currentDataOutput');
            output.innerHTML = `
                <div class="status info">
                    <h4>å½“å‰æ•°æ®çŠ¶æ€:</h4>
                    <p><strong>è¯„åˆ†æ•°æ®æ–¹æ³•æ•°:</strong> ${Object.keys(debugApp.evaluationData).length}</p>
                    <p><strong>å·¥å…·æ˜ å°„æ–¹æ³•æ•°:</strong> ${Object.keys(debugApp.methodToolMappings).length}</p>
                    <p><strong>æµ‹è¯•æ–¹æ³•æ€»æ•°:</strong> ${debugApp.testMethods.length}</p>
                </div>
                <h4>è¯„åˆ†æ•°æ®:</h4>
                <pre>${JSON.stringify(debugApp.evaluationData, null, 2)}</pre>
                <h4>å·¥å…·æ˜ å°„:</h4>
                <pre>${JSON.stringify(debugApp.methodToolMappings, null, 2)}</pre>
            `;
        }

        function debugEvaluationStatus() {
            clearDebugLog();
            debugLog('å¼€å§‹è°ƒè¯•è¯„åˆ†çŠ¶æ€...');
            
            const status = debugApp.getEvaluationStatus();
            
            const output = document.getElementById('currentDataOutput');
            output.innerHTML += `
                <div class="status success">
                    <h4>è¯„åˆ†çŠ¶æ€ç»“æœ:</h4>
                    <p><strong>å·²å®Œæˆ:</strong> ${status.completed.length} ä¸ª - ${status.completed.join(', ')}</p>
                    <p><strong>éƒ¨åˆ†å®Œæˆ:</strong> ${status.incomplete.length} ä¸ª - ${status.incomplete.join(', ')}</p>
                    <p><strong>æœªå¼€å§‹:</strong> ${status.notStarted.length} ä¸ª - ${status.notStarted.join(', ')}</p>
                    <p><strong>æ€»æœªå®Œæˆ:</strong> ${status.totalUnevaluated} ä¸ª</p>
                </div>
            `;
        }

        function testStatusFunction() {
            const output = document.getElementById('statusTestOutput');
            
            try {
                const status = debugApp.getEvaluationStatus();
                output.innerHTML = `
                    <div class="status success">
                        <h4>âœ… çŠ¶æ€å‡½æ•°æµ‹è¯•æˆåŠŸ</h4>
                        <pre>${JSON.stringify(status, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="status error">
                        <h4>âŒ çŠ¶æ€å‡½æ•°æµ‹è¯•å¤±è´¥</h4>
                        <p>é”™è¯¯: ${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }

        // åˆå§‹åŒ–
        debugLog('è°ƒè¯•é¡µé¢å·²åŠ è½½');
        loadCurrentData();
    </script>
</body>
</html>
